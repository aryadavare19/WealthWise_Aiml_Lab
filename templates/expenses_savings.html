<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense & Savings Tracker | WealthWise</title>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">

  <style>
    body { margin: 0; font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #fffdf5, #fff8e6); color: #003366; }
    header { background: linear-gradient(90deg, #fff4cc, #ffe88a); padding: 25px; text-align: center; color: #004aad; font-size: 26px; font-weight: 700; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .container { width: 70%; margin: 40px auto; background: #fffdf7; padding: 35px; border-radius: 20px; box-shadow: 0 8px 22px rgba(255,215,0,0.15); border-top: 6px solid #ffd700; }
    h2 { text-align: center; color: #004aad; font-size: 30px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(255,215,0,0.25); }
    p { text-align: center; font-size: 16px; margin-bottom: 25px; color: #444; }
    label { font-weight: 600; font-size: 16px; display: block; margin-top: 15px; color: #003366; }
    input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ccc; margin-top: 6px; font-size: 15px; background: #fffdf5; transition: border 0.3s ease; box-sizing: border-box; }
    input:focus { border: 1.5px solid #ffd700; outline: none; box-shadow: 0 0 8px rgba(255,215,0,0.4); }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    th { background: #ffd700; color: #004aad; font-weight: 700; }
    button { padding: 12px 20px; background: #ffd700; color: #004aad; border: none; font-size: 16px; font-weight: 600; border-radius: 25px; cursor: pointer; transition: 0.3s; margin-top: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    button:hover { background: #fff7c2; transform: translateY(-2px); }
    .remove { background: #ff7373; color: white; padding: 6px 12px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s ease; margin-top: 0; }
    .remove:hover { background: #ff4d4d; transform: scale(1.1); }
    .result-box { background: #fff7db; padding: 18px; border-radius: 12px; margin-top: 25px; border-left: 6px solid #ffd700; box-shadow: 0 4px 12px rgba(255,215,0,0.2); }
    .back-btn { display: block; margin: 35px auto 0; width: 40%; text-align: center; padding: 12px; background: #004aad; color: white; text-decoration: none; border-radius: 25px; font-size: 16px; font-weight: 600; transition: all 0.3s ease; }
    .back-btn:hover { background: #003080; box-shadow: 0 0 15px rgba(0,0,0,0.15); }
  </style>
</head>

<body>
<header>WealthWise — Expense & Savings Tracker</header>

<div class="container">
  <h2>Track Your Monthly Expenses</h2>
  <p>Visualize your spending patterns and calculate your monthly savings.</p>

  <form method="POST" id="expenseForm" action="{{ url_for('expenses_savings') }}">
    <label>Your Monthly Income (₹)</label>
    <input type="number" name="income" id="income" required value="{{ income if income }}">

    <h3 style="margin-top: 30px; color:#004aad;">Expenses</h3>

    <datalist id="categories">
      {% for cat in expense_categories %}
        <option value="{{ cat|capitalize }}">
      {% endfor %}
    </datalist>

    <table id="expenseTable">
      <thead>
        <tr>
          <th>Category</th>
          <th>Amount (₹)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in expenses_list %}
        <tr>
          <td><input name="category[]" list="categories" placeholder="e.g., Food, Rent" value="{{ item.category }}"></td>
          <td><input type="number" name="amount[]" class="amount-input" value="{{ item.amount }}"></td>
          <td><button type="button" class="remove" onclick="removeRow(this)">X</button></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <button type="button" onclick="addRow()">+ Add Expense</button>
    <button type="submit">Calculate Savings</button>
  </form>

  {% if savings is not none %}
  <div class="result-box">
    <h3>Summary</h3>
    <p><b>Total Income:</b> ₹{{ income }}</p>
    <p><b>Total Expenses:</b> ₹{{ total_expenses }}</p>
    <p>
      <b>Net Monthly Savings:</b> 
      <span style="color: {% if savings >= 0 %}#2ecc71{% else %}#e74c3c{% endif %}; font-weight: bold;">
        ₹{{ savings }}
      </span>
    </p>
    
    {% if prediction_text %}
    <hr style="border-top: 1px dashed #ccc;">
    <p style="color: #004aad; font-weight: 600;">{{ prediction_text }}</p>
    {% endif %}
  </div>
  {% endif %}
</div>

<a class="back-btn" href="{{ url_for('dashboard') }}">← Back to Dashboard</a>

<script>
function addRow() {
  const table = document.getElementById("expenseTable").getElementsByTagName('tbody')[0];
  const row = `
    <tr>
      <td><input name="category[]" list="categories" placeholder="e.g., Food, Rent"></td>
      <td><input type="number" name="amount[]" class="amount-input"></td>
      <td><button type="button" class="remove" onclick="removeRow(this)">X</button></td>
    </tr>`;
  table.insertAdjacentHTML('beforeend', row);
}

function removeRow(btn) {
  const table = document.getElementById("expenseTable").getElementsByTagName('tbody')[0];
  if(table.rows.length > 1) {
    btn.parentNode.parentNode.remove();
  }
}
</script>

</body>
</html>